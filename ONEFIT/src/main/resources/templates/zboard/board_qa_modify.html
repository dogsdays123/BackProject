<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/basic.html}">
<body>
    <div layout:fragment="board_qa_modify">
        <div class="container mt-5">
          <div class="card p-4 shadow-sm">
            <h2 class="text-primary post-title">게시글 수정</h2>

            <!-- 수정 폼 -->
            <form th:action="@{/zboard/board_qa_modify}" method="post" id="f1">
                <!-- qnaId -->
                <div class="mb-3">
                    <input type="hidden" name="qnaId" class="form-control" th:value="${dto.qnaId}" >
                </div>
                <!-- 제목 -->
                <div class="mb-3">
                    <label class="form-label">제목</label>
                    <input type="text" name="qTitle" class="form-control" th:value="${dto.qTitle}" >
                </div>

                <!-- 본문 -->
                <div class="mb-3">
                    <label class="form-label">본문</label>
                    <textarea name="qContent" class="form-control" rows="6">[[${dto.qContent}]]</textarea>
                </div>
                <!-- 작성자 -->
                <div class="mb-3">
                    <input type="hidden" name="allMember" class="form-control" th:value="${dto.allMember.allId}" >
                </div>

<!--                &lt;!&ndash; 기존 첨부파일 목록 &ndash;&gt;-->
<!--                <div class="mb-3">-->
<!--                    <label class="form-label">첨부파일</label>-->
<!--                    <div id="fileList" class="file-list">-->
<!--                        <div class="file-item">-->
<!--                            <a href="uploads/sample.pdf" download>sample.pdf</a>-->
<!--                            <button type="button" onclick="removeFile(this)">❌</button>-->
<!--                        </div>-->
<!--                        <div class="file-item">-->
<!--                            <a href="uploads/sample.jpg" download>sample.jpg</a>-->
<!--                            <button type="button" onclick="removeFile(this)">❌</button>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->

<!--                &lt;!&ndash; 새로운 파일 추가 &ndash;&gt;-->
<!--                <div class="mb-3">-->
<!--                    <label for="newFiles" class="form-label">새로운 파일 추가</label>-->
<!--                    <input type="file" id="newFiles" name="files[]" class="form-control" multiple>-->
<!--                </div>-->

                <!-- 버튼 그룹 -->
                <div class="d-flex justify-content-end">
                    <button type="button" class="btn btn-secondary me-2 listBtn">목록</button>
                    <button type="submit" class="btn btn-primary ms-2 modBtn">저장</button>
                    <button type="button" class="btn btn-danger ms-2 removeBtn">삭제</button>
                </div>
            </form>
        </div>
        <br>
        <br>
        </div>
    </div>

    <!-- FontAwesome CDN (아이콘 사용을 위한 링크) -->
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <!-- bootstrap js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script layout:fragment="script" layout:inline="javascript">

        const errors = [[${errors}]]
        console.log(errors)

        let errorMsg = ''

        if(errors){
            for (let i = 0; i < errors.length; i++) {
                errorMsg += `${errors[i].field}은(는) ${errors[i].code} \n`
            }
            history.replaceState({}, null, null)
            alert(errorMsg)
        }

        const link = [[${pageRequestDTO.getLink()}]]
        const formObj = document.querySelector("#f1")

        document.querySelector(".modBtn").addEventListener("click", function(e){
            e.preventDefault()
            e.stopPropagation()

            formObj.action = `/zboard/board_qa_modify?${link}`

            //첨부파일을 <input type = 'hidden..>으로추가
            appendFileData()
            //삭제대상 파일들의 삭제
            callRemoveFiles()

            formObj.method ='post'
            formObj.submit()


        }, false)

        document.querySelector(".removeBtn").addEventListener("click", function(e){
            e.preventDefault()
            e.stopPropagation()

            formObj.action = `/zboard/board_qa_remove`
            formObj.method ='post'
            formObj.submit()
        }, false)

        document.querySelector(".listBtn").addEventListener("click", function(e){
            e.preventDefault()
            e.stopPropagation()

            formObj.reset()
            self.location =`/zboard/board_qa_list?${link}`

        }, false)

    </script>
</body>

</html>